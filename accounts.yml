# ---
# - name: "Password and Account Settings"
#   hosts: all
#   gather_facts: no

  # tasks:

  #section1
    - block:
        - name: "1.1.1 | PATCH | Ensure Enforce password history is set to 24 or more passwords. | Set Variable."
          community.windows.win_security_policy:
            section: System Access
            key: PasswordHistorySize
            value: 24
      tags:
        - patch
        - password

    - block:
        - name: "1.1.2 | PATCH | Ensure Maximum password age is set to 365 or fewer days but not 0. | Set Variable."
          community.windows.win_security_policy:
            section: System Access
            key: MaximumPasswordAge
            value: 365
      tags:
        - patch
        - password

    - block:
        - name: "1.1.3 | PATCH | Ensure Minimum password age is set to 1 or more days. | Set Variable."
          community.windows.win_security_policy:
            section: System Access
            key: MinimumPasswordAge
            value: 1
      tags:
        - patch
        - password

    - name: "1.1.6 | PATCH | Ensure Relax minimum password length limits is set to Enabled. (First occurrence)"
      ansible.windows.win_regedit:
        path: HKLM:\SYSTEM\CurrentControlSet\Control\SAM
        name: RelaxMinimumPasswordLengthLimits
        data: 1
        type: dword
      tags:
        - patch
        - password

    - block:
        - name: "1.1.4 | PATCH | Ensure Minimum password length is set to 14 or more characters. | Set Variable."
          community.windows.win_security_policy:
            section: System Access
            key: MinimumPasswordLength
            value: 14
      tags:
        - patch
        - password

    - name: "1.1.5 | PATCH | Ensure Password must meet complexity requirements is set to Enabled."
      community.windows.win_security_policy:
        section: System Access
        key: PasswordComplexity
        value: 1
      tags:
        - patch
        - password

    - name: "1.1.6 | PATCH | Ensure Relax minimum password length limits is set to Enabled. (Second occurrence)"
      ansible.windows.win_regedit:
        path: HKLM:\SYSTEM\CurrentControlSet\Control\SAM
        name: RelaxMinimumPasswordLengthLimits
        data: 1
        type: dword
      tags:
        - patch
        - password

    - name: "1.1.7 | PATCH | Ensure Store passwords using reversible encryption is set to Disabled"
      community.windows.win_security_policy:
        section: System Access
        key: ClearTextPassword
        value: 0
      tags:
        - patch
        - password

    - block:
        - name: "1.2.2 | PATCH | Ensure Account lockout threshold is set to 5 or fewer invalid logon attempt(s), but not 0. | Set Variable."
          community.windows.win_security_policy:
            section: System Access
            key: LockoutBadCount
            value: 5
      tags:
        - patch
        - account

    - name: "1.2.3 | PATCH | Ensure Allow Administrator account lockout is set to Enabled"
      community.windows.win_security_policy:
        section: System Access
        key: AllowAdministratorLockout
        value: 1
      tags:
        - patch
        - password

    - block:
        - name: "1.2.4 | PATCH | Ensure Reset account lockout counter after is set to 15 or more minutes. | Set Variable."
          community.windows.win_security_policy:
            section: System Access
            key: ResetLockoutCount
            value: 15
      tags:
        - patch
        - account

    - name: "1.2.1 | PATCH | Ensure Account lockout duration is set to 15 or more minutes. | Set Variable"
      community.windows.win_security_policy:
        section: System Access
        key: LockoutDuration
        value: 15
      tags:
        - patch
        - account
